"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{47825:function(e,t,r){r.d(t,{M:function(){return n}}),r(74590);var n=(0,r(58064).$)("3ee51c67189e2b7d6a121d0e57c2859697778aaa")},70265:function(e,t,r){r.d(t,{default:function(){return U}});var n,a,i=r(57437),s=r(16463),l=r(70518),o=r(89733),d=r(97529),u=r(23096),c=r(25524),f=r(27776),p=r(22468);r(74590);var E=r(58064),m=(0,E.$)("3047de3067a82dc5453db7770d6038992ed5e3bf");function N(e){let{workflowId:t}=e,{toObject:r}=(0,u._K)(),n=(0,c.D)({mutationFn:m,onSuccess:()=>{f.Am.success("工作流保存成功",{id:"save-workflow"})},onError:()=>{f.Am.error("保存失败",{id:"save-workflow"})}});return(0,i.jsxs)(o.z,{disabled:n.isPending,variant:"outline",className:"flex items-center gap-2",onClick:()=>{let e=JSON.stringify(r());f.Am.loading("正在保存...",{id:"save-workflow"}),n.mutate({id:t,definition:e})},children:[(0,i.jsx)(p.Z,{size:16,className:"stroke-blue-400"}),"保存"]})}var T=r(98094),b=r(47825),R=r(2265),_=r(4749);function y(e,t,r){let n=[];for(let a of _.C[e.data.type].inputs){let i=e.data.inputs[a.name];if((null==i?void 0:i.length)>0)continue;let s=t.filter(t=>t.target===e.id).find(e=>e.targetHandle===a.name);!(a.required&&s&&r.has(s.source))&&(!a.required&&(!s||s&&r.has(s.source))||n.push(a.name))}return n}(n=a||(a={}))[n.NO_ENTRY_POINT=0]="NO_ENTRY_POINT",n[n.INVALID_INPUTS=1]="INVALID_INPUTS";var g=r(59877),x=()=>{let{toObject:e}=(0,u._K)(),{setInvalidInputs:t,clearErrors:r}=(0,g.Z)(),n=(0,R.useCallback)(e=>{switch(null==e?void 0:e.type){case a.NO_ENTRY_POINT:f.Am.error("没找到触发器");break;case a.INVALID_INPUTS:f.Am.error("输入值不可为空"),t(e.invalidElements);break;default:f.Am.error("错误！")}},[t]);return(0,R.useCallback)(()=>{let{nodes:t,edges:a}=e(),{executionPlan:i,error:s}=function(e,t){let r=e.find(e=>_.C[e.data.type].isEntryPoint);if(!r)return{error:{type:0}};let n=[],a=new Set,i=y(r,t,a);i.length>0&&n.push({nodeId:r.id,inputs:i});let s=[{phase:1,nodes:[r]}];a.add(r.id);for(let r=2;r<=e.length&&a.size<e.length;r++){let i={phase:r,nodes:[]};for(let r of e){if(a.has(r.id))continue;let s=y(r,t,a);if(s.length>0){if(!(function(e,t,r){if(!e.id)return[];let n=new Set;return r.forEach(t=>{t.target===e.id&&n.add(t.source)}),t.filter(e=>n.has(e.id))})(r,e,t).every(e=>a.has(e.id)))continue;console.error("节点输入验证错误",r.id,s),n.push({nodeId:r.id,inputs:s})}i.nodes.push(r)}for(let e of i.nodes)a.add(e.id);s.push(i)}return n.length>0?{error:{type:1,invalidElements:n}}:{executionPlan:s}}(t,a);return s?(n(s),null):(r(),i)},[e,n,r])};function I(e){let{workflowId:t}=e,r=x(),{toObject:n}=(0,u._K)(),a=(0,c.D)({mutationFn:b.M,onSuccess:()=>{f.Am.success("执行开始",{id:"flow-execution"})},onError:()=>{f.Am.error("执行错误",{id:"flow-execution"})}});return(0,i.jsxs)(o.z,{variant:"outline",className:"flex items-center gap-2",disabled:a.isPending,onClick:()=>{r()&&a.mutate({workflowId:t,flowDefinition:JSON.stringify(n())})},children:[(0,i.jsx)(T.Z,{size:16,className:"stroke-orange-400"}),"运行"]})}var v=r(58184),S=(0,E.$)("6c1c04f605a38c8567e83c8e6f7ca0ebcd48984a");function A(e){let{workflowId:t}=e,r=x(),{toObject:n}=(0,u._K)(),a=(0,c.D)({mutationFn:S,onSuccess:()=>{f.Am.success("工作流已发布",{id:t})},onError:()=>{f.Am.error("发布错误",{id:t})}});return(0,i.jsxs)(o.z,{variant:"outline",className:"flex items-center gap-2",disabled:a.isPending,onClick:()=>{r()&&(f.Am.loading("工作流发布中...",{id:t}),a.mutate({id:t,flowDefinition:JSON.stringify(n())}))},children:[(0,i.jsx)(v.Z,{size:16,className:"stroke-green-400"}),"发布"]})}var O=r(37164),h=(0,E.$)("7218128e2cdf4273bd91f89961a1eedd113c31ea");function G(e){let{workflowId:t}=e,r=(0,c.D)({mutationFn:h,onSuccess:()=>{f.Am.success("工作流取消发布成功",{id:t})},onError:()=>{f.Am.error("工作流取消发布错误",{id:t})}});return(0,i.jsxs)(o.z,{variant:"outline",className:"flex items-center gap-2",disabled:r.isPending,onClick:()=>{f.Am.loading("工作流取消发布中...",{id:t}),r.mutate(t)},children:[(0,i.jsx)(O.Z,{size:16,className:"stroke-orange-500"}),"取消发布"]})}var L=r(87138),C=r(62447),j=r(49354);let w=C.fC,P=R.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)(C.aV,{ref:t,className:(0,j.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...n})});P.displayName=C.aV.displayName;let k=R.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)(C.xz,{ref:t,className:(0,j.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...n})});function W(e){let{workflowId:t}=e,r=(0,s.usePathname)(),n=null==r?void 0:r.split("/")[2];return(0,i.jsx)(w,{value:n,className:"w-[400px]",children:(0,i.jsxs)(P,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(L.default,{href:"/workflow/editor/".concat(t),children:(0,i.jsx)(k,{value:"editor",className:"w-full",children:"编辑器"})}),(0,i.jsx)(L.default,{href:"/workflow/runs/".concat(t),children:(0,i.jsx)(k,{value:"runs",className:"w-full",children:"日志"})})]})})}function U(e){let{title:t,subtitle:r,workflowId:n,hideButtons:a=!1,isPublished:u=!1}=e,c=(0,s.useRouter)();return(0,i.jsxs)("header",{className:"flex p-2 border-b-2 border-separate justify-between w-full h-[60px] sticky top-0 bg-background z-10",children:[(0,i.jsxs)("div",{className:"flex gap-1 flex-1",children:[(0,i.jsx)(d.Z,{content:"回退",children:(0,i.jsx)(o.z,{variant:"ghost",size:"icon",onClick:()=>c.back(),children:(0,i.jsx)(l.Z,{size:20})})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-bold text-ellipsis truncate",children:t}),r&&(0,i.jsx)("p",{className:"text-xs text-muted-foreground truncate text-ellipsis",children:r})]})]}),(0,i.jsx)(W,{workflowId:n}),(0,i.jsx)("div",{className:"flex gap-1 flex-1 justify-end",children:!1===a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(I,{workflowId:n}),u&&(0,i.jsx)(G,{workflowId:n}),!u&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N,{workflowId:n}),(0,i.jsx)(A,{workflowId:n})]})]})})]})}k.displayName=C.xz.displayName,R.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)(C.VY,{ref:t,className:(0,j.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...n})}).displayName=C.VY.displayName},97529:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(57437),a=r(2265),i=r(27071),s=r(49354);let l=i.zt,o=i.fC,d=i.xz,u=a.forwardRef((e,t)=>{let{className:r,sideOffset:a=4,...l}=e;return(0,n.jsx)(i.VY,{ref:t,sideOffset:a,className:(0,s.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...l})});function c(e){let{content:t,children:r,side:a}=e;return t?(0,n.jsx)(l,{delayDuration:0,children:(0,n.jsxs)(o,{children:[(0,n.jsx)(d,{asChild:!0,children:r}),(0,n.jsx)(u,{side:a,children:t})]})}):r}u.displayName=i.VY.displayName},74650:function(e,t,r){r.d(t,{o:function(){return s},q:function(){return i}});var n=r(57437),a=r(2265);let i=(0,a.createContext)(null);function s(e){let{children:t}=e,[r,s]=(0,a.useState)([]);return(0,n.jsx)(i.Provider,{value:{invalidInputs:r,setInvalidInputs:s,clearErrors:()=>{s([])}},children:t})}},89733:function(e,t,r){r.d(t,{d:function(){return o},z:function(){return d}});var n=r(57437),a=r(2265),i=r(71538),s=r(13027),l=r(49354);let o=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",sidebarItem:"gap-2 !justify-start hover:bg-accent hover:bg-primary/80 hover:text-primary-foreground",sidebarActiveItem:"gap-2 !justify-start bg-primary text-primary-foreground hover:bg-primary/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,asChild:d=!1,...u}=e,c=d?i.g7:"button";return(0,n.jsx)(c,{className:(0,l.cn)(o({variant:a,size:s,className:r})),ref:t,...u})});d.displayName="Button"},59877:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(2265),a=r(74650);function i(){let e=(0,n.useContext)(a.q);if(!e)throw Error("useFlowValidation 必须使用 FlowValidationContext");return e}},49354:function(e,t,r){r.d(t,{cn:function(){return i}});var n=r(44839),a=r(96164);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},4749:function(e,t,r){r.d(t,{C:function(){return O}});var n=r(57437),a=r(4436),i=r(86085);let s={type:i.U.LAUNCH_BROWSER,label:"新建标签页",icon:e=>(0,n.jsx)(a.Z,{className:"stroke-pink-400",...e}),isEntryPoint:!0,credits:0,inputs:[{label:"新建标签页 URL",name:"Website Url",type:i.G.STRING,helperText:"例如: https://www.baidu.com",required:!0,hideHandle:!0}],outputs:[{label:"页面",name:"Web page",type:i.G.BROWSER_INSTANCE}]};var l=r(706);let o={type:i.U.EXTRACT_TEXT_FROM_ELEMENT,label:"获取文本",icon:e=>(0,n.jsx)(l.Z,{className:"stroke-rose-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"HTML",label:"HTML",type:i.G.STRING,required:!0,variant:"textarea"},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0}],outputs:[{name:"Extracted text",label:"选取元素",type:i.G.STRING}]};var d=r(7746);let u={type:i.U.PAGE_TO_HTML,label:"获取HTML",icon:e=>(0,n.jsx)(d.Z,{className:"stroke-rose-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0}],outputs:[{name:"HTML",label:"HTML",type:i.G.STRING},{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var c=r(39451);let f={type:i.U.FILL_INPUT,label:"填充输入框",icon:e=>(0,n.jsx)(c.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0},{name:"Value",label:"值",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var p=r(89317);let E={type:i.U.CLICK_ELEMENT,label:"点击元素",icon:e=>(0,n.jsx)(p.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var m=r(75733);let N={type:i.U.WAIT_FOR_ELEMENT,label:"等待元素",icon:e=>(0,n.jsx)(m.Z,{className:"stroke-amber-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0},{name:"Visibility",label:"可见度",type:i.G.SELECT,required:!0,hideHandle:!0,options:[{label:"可见",value:"visible"},{label:"隐藏",value:"hidden"}]}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var T=r(60994);let b={type:i.U.DELIVER_VIA_WEBHOOK,label:"WebHook",icon:e=>(0,n.jsx)(T.Z,{className:"stroke-blue-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Target URL",label:"目标URL",type:i.G.STRING,required:!0},{name:"Body",label:"请求体",type:i.G.STRING,required:!0}],outputs:[]};var R=r(79869);let _={type:i.U.EXTRACT_DATA_WITH_AI,label:"AI提取数据",icon:e=>(0,n.jsx)(R.Z,{className:"stroke-rose-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Content",label:"内容",type:i.G.STRING,required:!0},{name:"Credentials",label:"凭证",type:i.G.CREDENTIAL,required:!0},{name:"Prompt",label:"提示词",type:i.G.STRING,required:!0,variant:"textarea"}],outputs:[{name:"Extracted data",label:"提取数据",type:i.G.STRING}]};var y=r(44216);let g={type:i.U.READ_PROPERTY_FROM_JSON,label:"读取JSON数据",icon:e=>(0,n.jsx)(y.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:1,inputs:[{name:"JSON",label:"JSON",type:i.G.STRING,required:!0},{name:"Property name",label:"名称",type:i.G.STRING,required:!0}],outputs:[{name:"Property value",label:"值",type:i.G.STRING}]};var x=r(97589);let I={type:i.U.ADD_PROPERTY_TO_JSON,label:"存储JSON数据",icon:e=>(0,n.jsx)(x.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:1,inputs:[{name:"JSON",label:"JSON",type:i.G.STRING,required:!0},{name:"Property name",label:"名称",type:i.G.STRING,required:!0},{name:"Property value",label:"值",type:i.G.STRING,required:!0}],outputs:[{name:"Updated JSON",label:"新JSON",type:i.G.STRING}]};var v=r(52449);let S={type:i.U.NAVIGATE_URL,label:"URL跳转",icon:e=>(0,n.jsx)(v.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:2,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"URL",label:"URL",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var A=r(63541);let O={LAUNCH_BROWSER:s,PAGE_TO_HTML:u,EXTRACT_TEXT_FROM_ELEMENT:o,FILL_INPUT:f,CLICK_ELEMENT:E,WAIT_FOR_ELEMENT:N,DELIVER_VIA_WEBHOOK:b,EXTRACT_DATA_WITH_AI:_,READ_PROPERTY_FROM_JSON:g,ADD_PROPERTY_TO_JSON:I,NAVIGATE_URL:S,SCROLL_TO_ELEMENT:{type:i.U.SCROLL_TO_ELEMENT,label:"滚动元素",icon:e=>(0,n.jsx)(A.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:1,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]}}},86085:function(e,t,r){var n,a,i,s;r.d(t,{G:function(){return a},U:function(){return n}}),(i=n||(n={})).LAUNCH_BROWSER="LAUNCH_BROWSER",i.PAGE_TO_HTML="PAGE_TO_HTML",i.EXTRACT_TEXT_FROM_ELEMENT="EXTRACT_TEXT_FROM_ELEMENT",i.FILL_INPUT="FILL_INPUT",i.CLICK_ELEMENT="CLICK_ELEMENT",i.WAIT_FOR_ELEMENT="WAIT_FOR_ELEMENT",i.DELIVER_VIA_WEBHOOK="DELIVER_VIA_WEBHOOK",i.EXTRACT_DATA_WITH_AI="EXTRACT_DATA_WITH_AI",i.READ_PROPERTY_FROM_JSON="READ_PROPERTY_FROM_JSON",i.ADD_PROPERTY_TO_JSON="ADD_PROPERTY_TO_JSON",i.NAVIGATE_URL="NAVIGATE_URL",i.SCROLL_TO_ELEMENT="SCROLL_TO_ELEMENT",(s=a||(a={})).STRING="STRING",s.BROWSER_INSTANCE="BROWSER_INSTANCE",s.SELECT="SELECT",s.CREDENTIAL="CREDENTIAL"}}]);