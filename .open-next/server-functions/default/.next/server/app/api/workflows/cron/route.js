"use strict";(()=>{var e={};e.id=515,e.ids=[515],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},11015:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>d,staticGenerationAsyncStorage:()=>E});var t={};r.r(t),r.d(t,{GET:()=>l});var n=r(49303),a=r(88716),s=r(60670),i=r(13538),u=r(42590);async function l(e){let o=new Date,r=await i.Z.workflow.findMany({select:{id:!0},where:{status:u.x8.PUBLISHED,cron:{not:null},nextRunAt:{lte:o}}});for(let e of r)(function(e){var o;fetch((o=`api/workflows/execute?workflowId=${e}`,`http://localhost:3000/${o}`),{headers:{Authorization:`Bearer ${process.env.API_SECRET}`},cache:"no-store"}).catch(o=>console.log("定时任务ID:",e,":error->",o.message))})(e.id);return Response.json({workflowsToRun:r.length},{status:200})}let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/workflows/cron/route",pathname:"/api/workflows/cron",filename:"route",bundlePath:"app/api/workflows/cron/route"},resolvedPagePath:"E:\\Demo\\next-workflow\\src\\app\\api\\workflows\\cron\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:E,serverHooks:d}=c,w="/api/workflows/cron/route";function f(){return(0,s.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:E})}},49303:(e,o,r)=>{e.exports=r(30517)},13538:(e,o,r)=>{r.d(o,{Z:()=>n});var t=r(53524);let n=globalThis.prismaGlobal??new t.PrismaClient},42590:(e,o,r)=>{var t,n,a,s;r.d(o,{KD:()=>s,NW:()=>a,WorkflowExecutionStatus:()=>n,x8:()=>t}),function(e){e.DRAFT="DRAFT",e.PUBLISHED="PUBLISHED"}(t||(t={})),function(e){e.PENDING="PENDING",e.RUNNING="RUNNING",e.COMPLETED="COMPLETED",e.FAILED="FAILED"}(n||(n={})),function(e){e.MANUAL="MANUAL",e.CRON="CRON"}(a||(a={})),function(e){e.CREATED="CREATED",e.PENDING="PENDING",e.RUNNING="RUNNING",e.COMPLETED="COMPLETED",e.FAILED="FAILED"}(s||(s={}))}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[948],()=>r(11015));module.exports=t})();