exports.id=581,exports.ids=[581],exports.modules={9476:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,79404,23)),Promise.resolve().then(r.bind(r,95466)),Promise.resolve().then(r.bind(r,78062))},35303:()=>{},20149:(e,t,r)=>{"use strict";r.d(t,{default:()=>W});var a,s=r(10326),i=r(35047),l=r(11890),n=r(91664),o=r(11828),d=r(9051),u=r(10119),c=r(85999),E=r(32933);r(15424);var f=r(46242),N=(0,f.$)("3047de3067a82dc5453db7770d6038992ed5e3bf");function p({workflowId:e}){let{toObject:t}=(0,d._K)(),r=(0,u.D)({mutationFn:N,onSuccess:()=>{c.Am.success("工作流保存成功",{id:"save-workflow"})},onError:()=>{c.Am.error("保存失败",{id:"save-workflow"})}});return(0,s.jsxs)(n.z,{disabled:r.isPending,variant:"outline",className:"flex items-center gap-2",onClick:()=>{let a=JSON.stringify(t());c.Am.loading("正在保存...",{id:"save-workflow"}),r.mutate({id:e,definition:a})},children:[s.jsx(E.Z,{size:16,className:"stroke-blue-400"}),"保存"]})}var T=r(94893),m=r(83995),R=r(17577),_=r(83761);function b(e,t,r){let a=[];for(let s of _.C[e.data.type].inputs){let i=e.data.inputs[s.name];if(i?.length>0)continue;let l=t.filter(t=>t.target===e.id).find(e=>e.targetHandle===s.name);!(s.required&&l&&r.has(l.source))&&(!s.required&&(!l||l&&r.has(l.source))||a.push(s.name))}return a}!function(e){e[e.NO_ENTRY_POINT=0]="NO_ENTRY_POINT",e[e.INVALID_INPUTS=1]="INVALID_INPUTS"}(a||(a={}));var x=r(45167);let S=()=>{let{toObject:e}=(0,d._K)(),{setInvalidInputs:t,clearErrors:r}=(0,x.Z)(),s=(0,R.useCallback)(e=>{switch(e?.type){case a.NO_ENTRY_POINT:c.Am.error("没找到触发器");break;case a.INVALID_INPUTS:c.Am.error("输入值不可为空"),t(e.invalidElements);break;default:c.Am.error("错误！")}},[t]);return(0,R.useCallback)(()=>{let{nodes:t,edges:a}=e(),{executionPlan:i,error:l}=function(e,t){let r=e.find(e=>_.C[e.data.type].isEntryPoint);if(!r)return{error:{type:0}};let a=[],s=new Set,i=b(r,t,s);i.length>0&&a.push({nodeId:r.id,inputs:i});let l=[{phase:1,nodes:[r]}];s.add(r.id);for(let r=2;r<=e.length&&s.size<e.length;r++){let i={phase:r,nodes:[]};for(let r of e){if(s.has(r.id))continue;let l=b(r,t,s);if(l.length>0){if(!(function(e,t,r){if(!e.id)return[];let a=new Set;return r.forEach(t=>{t.target===e.id&&a.add(t.source)}),t.filter(e=>a.has(e.id))})(r,e,t).every(e=>s.has(e.id)))continue;console.error("节点输入验证错误",r.id,l),a.push({nodeId:r.id,inputs:l})}i.nodes.push(r)}for(let e of i.nodes)s.add(e.id);l.push(i)}return a.length>0?{error:{type:1,invalidElements:a}}:{executionPlan:l}}(t,a);return l?(s(l),null):(r(),i)},[e,s,r])};function I({workflowId:e}){let t=S(),{toObject:r}=(0,d._K)(),a=(0,u.D)({mutationFn:m.M,onSuccess:()=>{c.Am.success("执行开始",{id:"flow-execution"})},onError:()=>{c.Am.error("执行错误",{id:"flow-execution"})}});return(0,s.jsxs)(n.z,{variant:"outline",className:"flex items-center gap-2",disabled:a.isPending,onClick:()=>{t()&&a.mutate({workflowId:e,flowDefinition:JSON.stringify(r())})},children:[s.jsx(T.Z,{size:16,className:"stroke-orange-400"}),"运行"]})}var w=r(63685),y=(0,f.$)("6c1c04f605a38c8567e83c8e6f7ca0ebcd48984a");function h({workflowId:e}){let t=S(),{toObject:r}=(0,d._K)(),a=(0,u.D)({mutationFn:y,onSuccess:()=>{c.Am.success("工作流已发布",{id:e})},onError:()=>{c.Am.error("发布错误",{id:e})}});return(0,s.jsxs)(n.z,{variant:"outline",className:"flex items-center gap-2",disabled:a.isPending,onClick:()=>{t()&&(c.Am.loading("工作流发布中...",{id:e}),a.mutate({id:e,flowDefinition:JSON.stringify(r())}))},children:[s.jsx(w.Z,{size:16,className:"stroke-green-400"}),"发布"]})}var A=r(31540),O=(0,f.$)("7218128e2cdf4273bd91f89961a1eedd113c31ea");function v({workflowId:e}){let t=(0,u.D)({mutationFn:O,onSuccess:()=>{c.Am.success("工作流取消发布成功",{id:e})},onError:()=>{c.Am.error("工作流取消发布错误",{id:e})}});return(0,s.jsxs)(n.z,{variant:"outline",className:"flex items-center gap-2",disabled:t.isPending,onClick:()=>{c.Am.loading("工作流取消发布中...",{id:e}),t.mutate(e)},children:[s.jsx(A.Z,{size:16,className:"stroke-orange-500"}),"取消发布"]})}var g=r(90434),L=r(28407),G=r(51223);let P=L.fC,k=R.forwardRef(({className:e,...t},r)=>s.jsx(L.aV,{ref:r,className:(0,G.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));k.displayName=L.aV.displayName;let C=R.forwardRef(({className:e,...t},r)=>s.jsx(L.xz,{ref:r,className:(0,G.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));function j({workflowId:e}){let t=(0,i.usePathname)(),r=t?.split("/")[2];return s.jsx(P,{value:r,className:"w-[400px]",children:(0,s.jsxs)(k,{className:"grid w-full grid-cols-2",children:[s.jsx(g.default,{href:`/workflow/editor/${e}`,children:s.jsx(C,{value:"editor",className:"w-full",children:"编辑器"})}),s.jsx(g.default,{href:`/workflow/runs/${e}`,children:s.jsx(C,{value:"runs",className:"w-full",children:"日志"})})]})})}function W({title:e,subtitle:t,workflowId:r,hideButtons:a=!1,isPublished:d=!1}){let u=(0,i.useRouter)();return(0,s.jsxs)("header",{className:"flex p-2 border-b-2 border-separate justify-between w-full h-[60px] sticky top-0 bg-background z-10",children:[(0,s.jsxs)("div",{className:"flex gap-1 flex-1",children:[s.jsx(o.Z,{content:"回退",children:s.jsx(n.z,{variant:"ghost",size:"icon",onClick:()=>u.back(),children:s.jsx(l.Z,{size:20})})}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-bold text-ellipsis truncate",children:e}),t&&s.jsx("p",{className:"text-xs text-muted-foreground truncate text-ellipsis",children:t})]})]}),s.jsx(j,{workflowId:r}),s.jsx("div",{className:"flex gap-1 flex-1 justify-end",children:!1===a&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(I,{workflowId:r}),d&&s.jsx(v,{workflowId:r}),!d&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(p,{workflowId:r}),s.jsx(h,{workflowId:r})]})]})})]})}C.displayName=L.xz.displayName,R.forwardRef(({className:e,...t},r)=>s.jsx(L.VY,{ref:r,className:(0,G.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t})).displayName=L.VY.displayName},68588:(e,t,r)=>{"use strict";r.d(t,{o:()=>l,q:()=>i});var a=r(10326),s=r(17577);let i=(0,s.createContext)(null);function l({children:e}){let[t,r]=(0,s.useState)([]);return a.jsx(i.Provider,{value:{invalidInputs:t,setInvalidInputs:r,clearErrors:()=>{r([])}},children:e})}},45167:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(17577),s=r(68588);function i(){let e=(0,a.useContext)(s.q);if(!e)throw Error("useFlowValidation 必须使用 FlowValidationContext");return e}},83761:(e,t,r)=>{"use strict";r.d(t,{C:()=>O});var a=r(10326),s=r(54014),i=r(25058);let l={type:i.U.LAUNCH_BROWSER,label:"新建标签页",icon:e=>a.jsx(s.Z,{className:"stroke-pink-400",...e}),isEntryPoint:!0,credits:0,inputs:[{label:"新建标签页 URL",name:"Website Url",type:i.G.STRING,helperText:"例如: https://www.baidu.com",required:!0,hideHandle:!0}],outputs:[{label:"页面",name:"Web page",type:i.G.BROWSER_INSTANCE}]};var n=r(96230);let o={type:i.U.EXTRACT_TEXT_FROM_ELEMENT,label:"获取文本",icon:e=>a.jsx(n.Z,{className:"stroke-rose-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"HTML",label:"HTML",type:i.G.STRING,required:!0,variant:"textarea"},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0}],outputs:[{name:"Extracted text",label:"选取元素",type:i.G.STRING}]};var d=r(92498);let u={type:i.U.PAGE_TO_HTML,label:"获取HTML",icon:e=>a.jsx(d.Z,{className:"stroke-rose-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0}],outputs:[{name:"HTML",label:"HTML",type:i.G.STRING},{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var c=r(82685);let E={type:i.U.FILL_INPUT,label:"填充输入框",icon:e=>a.jsx(c.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0},{name:"Value",label:"值",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var f=r(21066);let N={type:i.U.CLICK_ELEMENT,label:"点击元素",icon:e=>a.jsx(f.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var p=r(12714);let T={type:i.U.WAIT_FOR_ELEMENT,label:"等待元素",icon:e=>a.jsx(p.Z,{className:"stroke-amber-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0},{name:"Visibility",label:"可见度",type:i.G.SELECT,required:!0,hideHandle:!0,options:[{label:"可见",value:"visible"},{label:"隐藏",value:"hidden"}]}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var m=r(69436);let R={type:i.U.DELIVER_VIA_WEBHOOK,label:"WebHook",icon:e=>a.jsx(m.Z,{className:"stroke-blue-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Target URL",label:"目标URL",type:i.G.STRING,required:!0},{name:"Body",label:"请求体",type:i.G.STRING,required:!0}],outputs:[]};var _=r(98360);let b={type:i.U.EXTRACT_DATA_WITH_AI,label:"AI提取数据",icon:e=>a.jsx(_.Z,{className:"stroke-rose-400",...e}),isEntryPoint:!1,credits:0,inputs:[{name:"Content",label:"内容",type:i.G.STRING,required:!0},{name:"Credentials",label:"凭证",type:i.G.CREDENTIAL,required:!0},{name:"Prompt",label:"提示词",type:i.G.STRING,required:!0,variant:"textarea"}],outputs:[{name:"Extracted data",label:"提取数据",type:i.G.STRING}]};var x=r(86930);let S={type:i.U.READ_PROPERTY_FROM_JSON,label:"读取JSON数据",icon:e=>a.jsx(x.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:1,inputs:[{name:"JSON",label:"JSON",type:i.G.STRING,required:!0},{name:"Property name",label:"名称",type:i.G.STRING,required:!0}],outputs:[{name:"Property value",label:"值",type:i.G.STRING}]};var I=r(88319);let w={type:i.U.ADD_PROPERTY_TO_JSON,label:"存储JSON数据",icon:e=>a.jsx(I.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:1,inputs:[{name:"JSON",label:"JSON",type:i.G.STRING,required:!0},{name:"Property name",label:"名称",type:i.G.STRING,required:!0},{name:"Property value",label:"值",type:i.G.STRING,required:!0}],outputs:[{name:"Updated JSON",label:"新JSON",type:i.G.STRING}]};var y=r(1388);let h={type:i.U.NAVIGATE_URL,label:"URL跳转",icon:e=>a.jsx(y.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:2,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"URL",label:"URL",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]};var A=r(79256);let O={LAUNCH_BROWSER:l,PAGE_TO_HTML:u,EXTRACT_TEXT_FROM_ELEMENT:o,FILL_INPUT:E,CLICK_ELEMENT:N,WAIT_FOR_ELEMENT:T,DELIVER_VIA_WEBHOOK:R,EXTRACT_DATA_WITH_AI:b,READ_PROPERTY_FROM_JSON:S,ADD_PROPERTY_TO_JSON:w,NAVIGATE_URL:h,SCROLL_TO_ELEMENT:{type:i.U.SCROLL_TO_ELEMENT,label:"滚动元素",icon:e=>a.jsx(A.Z,{className:"stroke-orange-400",...e}),isEntryPoint:!1,credits:1,inputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE,required:!0},{name:"Selector",label:"选择器",type:i.G.STRING,required:!0}],outputs:[{name:"Web page",label:"页面",type:i.G.BROWSER_INSTANCE}]}}},25058:(e,t,r)=>{"use strict";var a,s;r.d(t,{G:()=>s,U:()=>a}),function(e){e.LAUNCH_BROWSER="LAUNCH_BROWSER",e.PAGE_TO_HTML="PAGE_TO_HTML",e.EXTRACT_TEXT_FROM_ELEMENT="EXTRACT_TEXT_FROM_ELEMENT",e.FILL_INPUT="FILL_INPUT",e.CLICK_ELEMENT="CLICK_ELEMENT",e.WAIT_FOR_ELEMENT="WAIT_FOR_ELEMENT",e.DELIVER_VIA_WEBHOOK="DELIVER_VIA_WEBHOOK",e.EXTRACT_DATA_WITH_AI="EXTRACT_DATA_WITH_AI",e.READ_PROPERTY_FROM_JSON="READ_PROPERTY_FROM_JSON",e.ADD_PROPERTY_TO_JSON="ADD_PROPERTY_TO_JSON",e.NAVIGATE_URL="NAVIGATE_URL",e.SCROLL_TO_ELEMENT="SCROLL_TO_ELEMENT"}(a||(a={})),function(e){e.STRING="STRING",e.BROWSER_INSTANCE="BROWSER_INSTANCE",e.SELECT="SELECT",e.CREDENTIAL="CREDENTIAL"}(s||(s={}))},94106:(e,t,r)=>{"use strict";r.r(t),r.d(t,{publishWorkflow:()=>d});var a=r(27745);r(26461);var s=r(30207),i=r(93396),l=r(24831),n=r(60006),o=r(18992);async function d({id:e,flowDefinition:t}){let{userId:r}=(0,i.auth)();if(!r)throw Error("账户错误");let a=await l.default.workflow.findUnique({where:{id:e,userId:r}});if(!a)throw Error("工作流未找到");if(a.status!==o.WorkflowStatus.DRAFT)throw Error("工作流不是未发布");let d=JSON.parse(t),u=(0,n.FlowToExecutionPlan)(d.nodes,d.edges);if(u.error)throw Error("工作流出错");if(!u.executionPlan)throw Error("未生成执行计划");await l.default.workflow.update({where:{id:e,userId:r},data:{definition:t,executionPlan:JSON.stringify(u.executionPlan),creditsCost:0,status:o.WorkflowStatus.PUBLISHED}}),(0,s.revalidatePath)(`/workflow/editor/${e}`)}(0,r(85723).ensureServerEntryExports)([d]),(0,a.registerServerReference)("6c1c04f605a38c8567e83c8e6f7ca0ebcd48984a",d)},31178:(e,t,r)=>{"use strict";r.r(t),r.d(t,{unpublishWorkflow:()=>o});var a=r(27745);r(26461);var s=r(30207),i=r(93396),l=r(24831),n=r(18992);async function o(e){let{userId:t}=(0,i.auth)();if(!t)throw Error("账户错误");let r=await l.default.workflow.findUnique({where:{id:e,userId:t}});if(!r)throw Error("工作流未找到");if(r.status!==n.WorkflowStatus.PUBLISHED)throw Error("工作流不是已发布");await l.default.workflow.update({where:{id:e,userId:t},data:{status:n.WorkflowStatus.DRAFT,executionPlan:null,creditsCost:0}}),(0,s.revalidatePath)(`/workflow/editor/${e}`)}(0,r(85723).ensureServerEntryExports)([o]),(0,a.registerServerReference)("7218128e2cdf4273bd91f89961a1eedd113c31ea",o)},56496:(e,t,r)=>{"use strict";r.r(t),r.d(t,{updateWorkflow:()=>o});var a=r(27745);r(26461);var s=r(30207),i=r(93396),l=r(24831),n=r(18992);async function o({id:e,definition:t}){let{userId:r}=(0,i.auth)();if(!r)throw Error("账号错误");let a=await l.default.workflow.findUnique({where:{id:e,userId:r}});if(!a)throw Error("未找到工作流");if(a.status!==n.WorkflowStatus.DRAFT)throw Error("工作流已发布");await l.default.workflow.update({data:{definition:t},where:{id:e,userId:r}}),(0,s.revalidatePath)("/workflows")}(0,r(85723).ensureServerEntryExports)([o]),(0,a.registerServerReference)("3047de3067a82dc5453db7770d6038992ed5e3bf",o)},56656:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(19510),s=r(75561),i=r(27075),l=r(98266);function n({children:e}){return(0,a.jsxs)("div",{className:"flex flex-col w-full h-screen",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2",children:[a.jsx(s.Z,{iconSize:16,fontSize:"text-xl"}),a.jsx(i.l,{})]}),a.jsx(l.Z,{}),e]})}},75561:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(19510);r(71159);var s=r(57371),i=r(40644),l=r(28259);let n=({fontSize:e="text-2xl",iconSize:t=20})=>(0,a.jsxs)(s.default,{href:"/",className:(0,i.cn)("text-2xl font-extrabold flex items-center gap-3",e),children:[a.jsx("div",{className:"rounded-xl bg-gradient-to-r from-indigo-500 to-indigo-500 p-2",children:a.jsx(l.Z,{size:t,className:"stroke-white"})}),a.jsx("div",{children:a.jsx("span",{className:"text-stone-700 dark:text-stone-300",children:"Next-WorkFlow"})})]})}};